(()=>{"use strict";var e={640:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(i,s){function r(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,o,i,s,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(a){return function(c){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;s&&(s=0,a[0]&&(r=0)),r;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,o=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!((i=(i=r.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){r=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){r.label=a[1];break}if(6===a[0]&&r.label<i[1]){r.label=i[1],i=a;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(a);break}i[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.PKI=void 0;var i=function(){function e(){var e=this;this.backend_url="https://pkiserviceconnect.azurewebsites.net",this.currentStep=0,this.listCertsFetched=!1,this.onStepOneConfirm=function(t){t.preventDefault(),e.fetchListCerts(),e.checkCsr(e.initContentTwo.bind(e))},this.onStepTwoConfirm=function(t){t.preventDefault(),e.sign(e.initContentThree.bind(e))},this.onBackClick=function(t){switch(e.currentStep){case 1:e.initContentOne(),document.getElementById("nav-step-back").disabled=!0;break;case 2:e.initContentTwo();break;case 3:e.initContentThree()}},this.init()}return e.prototype.init=function(){this.addEventListeners()},e.prototype.addEventListeners=function(){document.getElementById("nav-step-one-confirm").addEventListener("click",this.onStepOneConfirm),document.getElementById("nav-step-two-confirm").addEventListener("click",this.onStepTwoConfirm),document.getElementById("nav-step-back").addEventListener("click",this.onBackClick)},e.prototype.changeContent=function(e){this.currentStep=e,this.setStepperContent(e),this.setNavStepper(e),this.setStepperOverview(e)},e.prototype.initContentOne=function(){this.changeContent(0)},e.prototype.initContentTwo=function(){this.changeContent(1)},e.prototype.initContentThree=function(){this.changeContent(2)},e.prototype.setStepperContent=function(e){for(var t=document.getElementsByClassName("stepper-content"),n=0;n<t.length;n++)t[n].classList.add("hidden");t[e].classList.remove("hidden")},e.prototype.setNavStepper=function(e){for(var t=document.getElementsByClassName("nav-stepper"),n=0;n<t.length;n++)t[n].classList.add("hidden");t[e].classList.remove("hidden")},e.prototype.setStepperOverview=function(e){for(var t=document.querySelectorAll("ul#stepper-overview > li"),n=0;n<t.length;n++){var o=t[n].querySelector("span.inner-circle"),i=t[n].querySelector("span.text");o.classList.contains("bg-blue-200")&&(o.classList.remove("bg-blue-200"),o.classList.add("bg-gray-100")),i.classList.contains("text-blue-500")&&(i.classList.remove("text-blue-500"),i.classList.add("text-gray-800")),o.classList.contains("bg-green-300")&&(o.classList.remove("bg-green-300"),o.classList.add("bg-gray-100"));var s=t[n].querySelector("span.number");s.classList.contains("hidden")&&s.classList.remove("hidden");var r=t[n].querySelector("svg");r.classList.contains("hidden")||r.classList.add("hidden")}function a(e){var n=t[e].querySelector("span.inner-circle");n.classList.contains("bg-gray-100")&&(n.classList.remove("bg-gray-100"),n.classList.add("bg-green-300"));var o=t[e].querySelector("span.number");o.classList.contains("hidden")||o.classList.add("hidden");var i=t[e].querySelector("svg");i.classList.contains("hidden")&&i.classList.remove("hidden")}!function(e){var n=t[e].querySelector("span.inner-circle");n.classList.contains("bg-gray-100")&&(n.classList.remove("bg-gray-100"),n.classList.add("bg-blue-200"))}(e),e>0&&a(0),e>1&&a(1),e>2&&a(2)},e.prototype.showAlert=function(e){var t=document.querySelectorAll(".alert")[0];t.classList.remove("hidden"),t.querySelector(".message").textContent=e},e.prototype.setButtonLoading=function(e){document.querySelectorAll("button").forEach((function(t){t.querySelector(".loading")&&(e&&t.querySelector(".loading").classList.contains("hidden")?t.querySelector(".loading").classList.remove("hidden"):t.querySelector(".loading").classList.add("hidden")),t.disabled=e}))},e.prototype.fetchListCerts=function(){var e=this;this.listCertsFetched||(this.setButtonLoading(!0),fetch("".concat(this.backend_url,"/api/v1/listcerts"),{method:"GET",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(t){e.listCertsFetched=!0,e.setButtonLoading(!1);var n=document.getElementById("sign_with_ca");t.forEach((function(e){n.options[n.options.length]=new Option(e,e)}))})).catch((function(t){e.showAlert("".concat(t.message,' ("api/v1/check")')),e.setButtonLoading(!1)})))},e.prototype.getCRSValue=function(){var e=document.getElementById("csr");return JSON.stringify(e.value.replace(/\n/g,""))},e.prototype.checkCsr=function(e){var t=this;this.setButtonLoading(!0);var i=this.getCRSValue();fetch("".concat(this.backend_url,"/api/v1/check"),{method:"POST",headers:{"Content-Type":"application/json"},body:i}).then((function(e){return n(t,void 0,void 0,(function(){var t,n,i;return o(this,(function(o){switch(o.label){case 0:if(e.ok)return[3,9];t="(".concat(e.status,")"),n="",o.label=1;case 1:return o.trys.push([1,3,,8]),[4,e.clone().json()];case 2:return i=o.sent(),n=i.message||JSON.stringify(i),[3,8];case 3:o.sent(),o.label=4;case 4:return o.trys.push([4,6,,7]),[4,e.clone().text()];case 5:return n=o.sent(),[3,7];case 6:return o.sent(),[3,7];case 7:return[3,8];case 8:throw n&&(t=n),new Error(t);case 9:return[2,e.json()]}}))}))})).then((function(n){document.getElementById("country_name").value=n.country,document.getElementById("state_name").value=n.state,document.getElementById("locality_name").value=n.locality,document.getElementById("organization_name").value=n.organization,document.getElementById("organization_unit_name").value=n.organizationUnit,document.getElementById("common_name").value=n.commonName,document.getElementById("email_address").value=n.emailAddress,t.setButtonLoading(!1),e()})).catch((function(e){t.showAlert("".concat(e.message,' ("api/v1/check")')),t.setButtonLoading(!1)}))},e.prototype.sign=function(e){var t=this,n=this.getCRSValue(),o=document.getElementById("common_name").value,i=document.getElementById("sign_with_ca").value;fetch("".concat(this.backend_url,"/api/v1/sign"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({Csr:n,commonName:o,CaName:i})}).then((function(e){var t=e.headers.get("Content-Disposition").match(/filename=([^;]+)/),n=t?t[1]:"certificate.pem";return e.blob().then((function(e){return{blob:e,filename:n}}))})).then((function(t){var n=t.blob,o=t.filename,i=document.getElementById("nav-step-three-confirm"),s=window.URL.createObjectURL(n);i.href=s,i.download=o,e()})).catch((function(e){t.showAlert("".concat(e.message,' ("api/v1/sign")'))}))},e}();t.PKI=i}},t={};new(function n(o){var i=t[o];if(void 0!==i)return i.exports;var s=t[o]={exports:{}};return e[o].call(s.exports,s,s.exports,n),s.exports}(640).PKI)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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U0FBUSxFQUFqQixHQUN4QyxJQUNDdEMsTUFBSyxTQUFDLEcsSUFBRXVDLEVBQUksT0FBRUQsRUFBUSxXQUNiakMsRUFBVTlDLFNBQVNDLGVBQWUsMEJBQ2xDZ0YsRUFBTUMsT0FBT0MsSUFBSUMsZ0JBQWdCSixHQUV2Q2xDLEVBQVF1QyxLQUFPSixFQUNmbkMsRUFBUXdDLFNBQVdQLEVBRW5CdEIsR0FDSixJQUNDUixPQUFNLFNBQUNDLEdBQ0osRUFBS3BCLFVBQVUsVUFBR29CLEVBQU1uQixRQUFPLG9CQUNuQyxHQUNSLEVBR0osRUFqVEEsR0FBYSxFQUFBd0QsSUFBQUEsQyxHQ0NUQyxFQUEyQixDQUFDLEVDQ2hDLElERUEsU0FBU0MsRUFBb0JDLEdBRTVCLElBQUlDLEVBQWVILEVBQXlCRSxHQUM1QyxRQUFxQkUsSUFBakJELEVBQ0gsT0FBT0EsRUFBYUUsUUFHckIsSUFBSUMsRUFBU04sRUFBeUJFLEdBQVksQ0FHakRHLFFBQVMsQ0FBQyxHQU9YLE9BSEFFLEVBQW9CTCxHQUFVTSxLQUFLRixFQUFPRCxRQUFTQyxFQUFRQSxFQUFPRCxRQUFTSixHQUdwRUssRUFBT0QsT0FDZixDQ3RCQSxNQUVJTixJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL1BraS50cyIsIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBjbGFzcyBQS0kge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGJhY2tlbmRfdXJsOnN0cmluZyA9IFwiaHR0cHM6Ly9wa2lzZXJ2aWNlY29ubmVjdC5henVyZXdlYnNpdGVzLm5ldFwiO1xuICAgIHByaXZhdGUgY3VycmVudFN0ZXA6IG51bWJlciA9IDA7XG4gICAgcHJpdmF0ZSBsaXN0Q2VydHNGZXRjaGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICBwcml2YXRlIGluaXQoKTogYW55IHtcbiAgICAgICAgdGhpcy5hZGRFdmVudExpc3RlbmVycygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgYWRkRXZlbnRMaXN0ZW5lcnMoKTogYW55IHtcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ25hdi1zdGVwLW9uZS1jb25maXJtJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uU3RlcE9uZUNvbmZpcm0pO1xuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmF2LXN0ZXAtdHdvLWNvbmZpcm0nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMub25TdGVwVHdvQ29uZmlybSk7XG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYXYtc3RlcC1iYWNrJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLm9uQmFja0NsaWNrKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uU3RlcE9uZUNvbmZpcm06IEV2ZW50TGlzdGVuZXIgPSAoZXZlbnQ6IEV2ZW50KSA9PiB7IFxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIHRoaXMuZmV0Y2hMaXN0Q2VydHMoKTtcbiAgICAgICAgdGhpcy5jaGVja0Nzcih0aGlzLmluaXRDb250ZW50VHdvLmJpbmQodGhpcykpXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBvblN0ZXBUd29Db25maXJtOiBFdmVudExpc3RlbmVyID0gKGV2ZW50OiBFdmVudCkgPT4geyBcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMuc2lnbih0aGlzLmluaXRDb250ZW50VGhyZWUuYmluZCh0aGlzKSlcbiAgICB9XG5cbiAgICBwcml2YXRlIG9uQmFja0NsaWNrOiBFdmVudExpc3RlbmVyID0gKGV2ZW50OiBFdmVudCkgPT4ge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuY3VycmVudFN0ZXApIHtcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRDb250ZW50T25lKCk7XG4gICAgICAgICAgICAgICAgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYXYtc3RlcC1iYWNrJykgYXMgSFRNTEJ1dHRvbkVsZW1lbnQpLmRpc2FibGVkID0gdHJ1ZVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIHRoaXMuaW5pdENvbnRlbnRUd28oKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICB0aGlzLmluaXRDb250ZW50VGhyZWUoKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGNoYW5nZUNvbnRlbnQoY291bnQ6IG51bWJlcik6IGFueSB7IFxuICAgICAgICB0aGlzLmN1cnJlbnRTdGVwID0gY291bnQ7XG4gICAgICAgIHRoaXMuc2V0U3RlcHBlckNvbnRlbnQoY291bnQpO1xuICAgICAgICB0aGlzLnNldE5hdlN0ZXBwZXIoY291bnQpO1xuICAgICAgICB0aGlzLnNldFN0ZXBwZXJPdmVydmlldyhjb3VudCk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbml0Q29udGVudE9uZSgpOiBhbnkge1xuICAgICAgICAgLy8gMCBpcyBmaXJzdCBzdGVwXG4gICAgICAgICB0aGlzLmNoYW5nZUNvbnRlbnQoMCk7XG5cbiAgICB9XG5cbiAgICBwcml2YXRlIGluaXRDb250ZW50VHdvKCk6IGFueSB7XG4gICAgICAgIC8vIDEgaXMgc2Vjb25kIHN0ZXBcbiAgICAgICAgdGhpcy5jaGFuZ2VDb250ZW50KDEpO1xuICAgIH1cblxuICAgIHByaXZhdGUgaW5pdENvbnRlbnRUaHJlZSgpOiBhbnkge1xuICAgICAgICAvLyAyIGlzIHRoaXJkIHN0ZXBcbiAgICAgICAgdGhpcy5jaGFuZ2VDb250ZW50KDIpO1xuICAgIH1cblxuICAgIHByaXZhdGUgc2V0U3RlcHBlckNvbnRlbnQoY291bnQ6IG51bWJlcik6IGFueSB7XG4gICAgICAgIGNvbnN0IHN0ZXBwZXJDb250ZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnc3RlcHBlci1jb250ZW50Jyk7XG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgc3RlcHBlckNvbnRlbnQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHN0ZXBwZXJDb250ZW50W2ldLmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgICAgICB9XG4gICAgICAgIHN0ZXBwZXJDb250ZW50W2NvdW50XS5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHNldE5hdlN0ZXBwZXIoY291bnQ6IG51bWJlcik6IGFueSB7XG4gICAgICAgIGNvbnN0IG5hdlN0ZXBwZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCduYXYtc3RlcHBlcicpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5hdlN0ZXBwZXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIG5hdlN0ZXBwZXJbaV0uY2xhc3NMaXN0LmFkZCgnaGlkZGVuJyk7XG4gICAgICAgIH1cbiAgICAgICAgbmF2U3RlcHBlcltjb3VudF0uY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRTdGVwcGVyT3ZlcnZpZXcoY291bnQ6IG51bWJlcik6IGFueSB7XG4gICAgICAgIGNvbnN0IHN0ZXBwZXJPdmVydmlld0VsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgndWwjc3RlcHBlci1vdmVydmlldyA+IGxpJyk7XG5cbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGVwcGVyT3ZlcnZpZXdFbGVtZW50cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgJGlubmVyY2lyY2xlID0gc3RlcHBlck92ZXJ2aWV3RWxlbWVudHNbaV0ucXVlcnlTZWxlY3RvcihcInNwYW4uaW5uZXItY2lyY2xlXCIpXG4gICAgICAgICAgICBjb25zdCAkdGV4dCA9IHN0ZXBwZXJPdmVydmlld0VsZW1lbnRzW2ldLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLnRleHRcIilcbiAgICAgICAgICAgIC8vIHJlbW92ZSBhY3RpdmUgc3R5bGluZ1xuICAgICAgICAgICAgaWYgKCRpbm5lcmNpcmNsZS5jbGFzc0xpc3QuY29udGFpbnMoJ2JnLWJsdWUtMjAwJykpIHtcbiAgICAgICAgICAgICAgICAkaW5uZXJjaXJjbGUuY2xhc3NMaXN0LnJlbW92ZSgnYmctYmx1ZS0yMDAnKVxuICAgICAgICAgICAgICAgICRpbm5lcmNpcmNsZS5jbGFzc0xpc3QuYWRkKCdiZy1ncmF5LTEwMCcpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJHRleHQuY2xhc3NMaXN0LmNvbnRhaW5zKCd0ZXh0LWJsdWUtNTAwJykpIHtcbiAgICAgICAgICAgICAgICAkdGV4dC5jbGFzc0xpc3QucmVtb3ZlKCd0ZXh0LWJsdWUtNTAwJylcbiAgICAgICAgICAgICAgICAkdGV4dC5jbGFzc0xpc3QuYWRkKCd0ZXh0LWdyYXktODAwJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgICAvLyByZW1vdmUgc3VjY2VzcyBzdHlsaW5nXG4gICAgICAgICAgICBpZiAoJGlubmVyY2lyY2xlLmNsYXNzTGlzdC5jb250YWlucygnYmctZ3JlZW4tMzAwJykpIHtcbiAgICAgICAgICAgICAgICAkaW5uZXJjaXJjbGUuY2xhc3NMaXN0LnJlbW92ZSgnYmctZ3JlZW4tMzAwJylcbiAgICAgICAgICAgICAgICAkaW5uZXJjaXJjbGUuY2xhc3NMaXN0LmFkZCgnYmctZ3JheS0xMDAnKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgJG51bWJlciA9IHN0ZXBwZXJPdmVydmlld0VsZW1lbnRzW2ldLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLm51bWJlclwiKSBcbiAgICAgICAgICAgIGlmICgkbnVtYmVyLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHtcbiAgICAgICAgICAgICAgICAkbnVtYmVyLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpOyAgICBcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjb25zdCAkY2hlY2tib3ggPSBzdGVwcGVyT3ZlcnZpZXdFbGVtZW50c1tpXS5xdWVyeVNlbGVjdG9yKFwic3ZnXCIpXG4gICAgICAgICAgICBpZiAoISRjaGVja2JveC5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7XG4gICAgICAgICAgICAgICAgJGNoZWNrYm94LmNsYXNzTGlzdC5hZGQoJ2hpZGRlbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBmdW5jdGlvbiBzZXRTdWNjZXNzQ2xhc3MoY291bnQ6IG51bWJlcikge1xuICAgICAgICAgICAgY29uc3QgJGlubmVyY2lyY2xlID0gc3RlcHBlck92ZXJ2aWV3RWxlbWVudHNbY291bnRdLnF1ZXJ5U2VsZWN0b3IoXCJzcGFuLmlubmVyLWNpcmNsZVwiKVxuICAgICAgICAgICAgaWYgKCRpbm5lcmNpcmNsZS5jbGFzc0xpc3QuY29udGFpbnMoJ2JnLWdyYXktMTAwJykpIHtcbiAgICAgICAgICAgICAgICAkaW5uZXJjaXJjbGUuY2xhc3NMaXN0LnJlbW92ZSgnYmctZ3JheS0xMDAnKVxuICAgICAgICAgICAgICAgICRpbm5lcmNpcmNsZS5jbGFzc0xpc3QuYWRkKCdiZy1ncmVlbi0zMDAnKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgJG51bWJlciA9IHN0ZXBwZXJPdmVydmlld0VsZW1lbnRzW2NvdW50XS5xdWVyeVNlbGVjdG9yKFwic3Bhbi5udW1iZXJcIilcbiAgICAgICAgICAgIGlmICghJG51bWJlci5jbGFzc0xpc3QuY29udGFpbnMoJ2hpZGRlbicpKSB7XG4gICAgICAgICAgICAgICAgJG51bWJlci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsgICAgXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY29uc3QgJGNoZWNrYm94ID0gc3RlcHBlck92ZXJ2aWV3RWxlbWVudHNbY291bnRdLnF1ZXJ5U2VsZWN0b3IoXCJzdmdcIilcbiAgICAgICAgICAgIGlmICgkY2hlY2tib3guY2xhc3NMaXN0LmNvbnRhaW5zKCdoaWRkZW4nKSkge1xuICAgICAgICAgICAgICAgICRjaGVja2JveC5jbGFzc0xpc3QucmVtb3ZlKCdoaWRkZW4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHNldEFjdGl2ZUNsYXNzKGNvdW50OiBudW1iZXIpIHtcbiAgICAgICAgICAgIGNvbnN0ICRpbm5lcmNpcmNsZSA9IHN0ZXBwZXJPdmVydmlld0VsZW1lbnRzW2NvdW50XS5xdWVyeVNlbGVjdG9yKFwic3Bhbi5pbm5lci1jaXJjbGVcIilcbiAgICAgICAgICAgIGlmICgkaW5uZXJjaXJjbGUuY2xhc3NMaXN0LmNvbnRhaW5zKCdiZy1ncmF5LTEwMCcpKSB7XG4gICAgICAgICAgICAgICAgJGlubmVyY2lyY2xlLmNsYXNzTGlzdC5yZW1vdmUoJ2JnLWdyYXktMTAwJylcbiAgICAgICAgICAgICAgICAkaW5uZXJjaXJjbGUuY2xhc3NMaXN0LmFkZCgnYmctYmx1ZS0yMDAnKVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBzZXRBY3RpdmVDbGFzcyhjb3VudClcblxuICAgICAgICBpZiAoY291bnQgPiAwKSB7XG4gICAgICAgICAgICBzZXRTdWNjZXNzQ2xhc3MoMClcbiAgICAgICAgfVxuICAgICAgICBpZiAoY291bnQgPiAxKSB7XG4gICAgICAgICAgICBzZXRTdWNjZXNzQ2xhc3MoMSlcbiAgICAgICAgfVxuICAgICAgICBpZiAoY291bnQgPiAyKSB7XG4gICAgICAgICAgICBzZXRTdWNjZXNzQ2xhc3MoMilcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHByaXZhdGUgc2hvd0FsZXJ0KG1lc3NhZ2U6IHN0cmluZykgeyBcbiAgICAgICAgY29uc3QgZXJyb3JFbGVtZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmFsZXJ0JylbMF07XG5cbiAgICAgICAgZXJyb3JFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgICAgICBlcnJvckVsZW1lbnQucXVlcnlTZWxlY3RvcignLm1lc3NhZ2UnKS50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBzZXRCdXR0b25Mb2FkaW5nKGVuYWJsZTogYm9vbGVhbik6IGFueSB7XG4gICAgICAgIGNvbnN0IGJ1dHRvbkVsZW1lbnRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnYnV0dG9uJyk7XG4gICAgXG4gICAgICAgIC8vIGZpbmQgZWxlbWVudCBpbiBidXR0b25lbGVtZW50cyB3aXRoIGNsYXNzIGxvYWRpbmcgYW5kIHJlbW92ZSBoaWRkZW4gY2xhc3NcbiAgICAgICAgYnV0dG9uRWxlbWVudHMuZm9yRWFjaCgoYnV0dG9uRWxlbWVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGJ1dHRvbkVsZW1lbnQucXVlcnlTZWxlY3RvcignLmxvYWRpbmcnKSkge1xuICAgICAgICAgICAgICAgIGlmIChlbmFibGUgJiYgYnV0dG9uRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZGluZycpLmNsYXNzTGlzdC5jb250YWlucygnaGlkZGVuJykpIHtcbiAgICAgICAgICAgICAgICAgICAgYnV0dG9uRWxlbWVudC5xdWVyeVNlbGVjdG9yKCcubG9hZGluZycpLmNsYXNzTGlzdC5yZW1vdmUoJ2hpZGRlbicpO1xuICAgICAgICAgICAgICAgIH0gXG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQucXVlcnlTZWxlY3RvcignLmxvYWRpbmcnKS5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGJ1dHRvbkVsZW1lbnQuZGlzYWJsZWQgPSBlbmFibGU7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmZXRjaExpc3RDZXJ0cygpOiBhbnkgeyBcbiAgICAgICAgaWYgKCF0aGlzLmxpc3RDZXJ0c0ZldGNoZWQpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0QnV0dG9uTG9hZGluZyh0cnVlKTtcblxuICAgICAgICAgICAgZmV0Y2goYCR7dGhpcy5iYWNrZW5kX3VybH0vYXBpL3YxL2xpc3RjZXJ0c2AsIHtcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcbiAgICAgICAgICAgICAgICAudGhlbihkYXRhID0+IHsgXG4gICAgICAgICAgICAgICAgICAgIHRoaXMubGlzdENlcnRzRmV0Y2hlZCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0QnV0dG9uTG9hZGluZyhmYWxzZSk7XG4gICAgXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHNpZ25XaXRoQ2EgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbl93aXRoX2NhJykgYXMgSFRNTFNlbGVjdEVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgICAgIGRhdGEuZm9yRWFjaCgoZWxlbWVudDogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzaWduV2l0aENhLm9wdGlvbnNbc2lnbldpdGhDYS5vcHRpb25zLmxlbmd0aF0gPSBuZXcgT3B0aW9uKGVsZW1lbnQsIGVsZW1lbnQpXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgIFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaCgoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dBbGVydChgJHtlcnJvci5tZXNzYWdlfSAoXCJhcGkvdjEvY2hlY2tcIilgKVxuICAgICAgICAgICAgICAgIHRoaXMuc2V0QnV0dG9uTG9hZGluZyhmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgfVxuXG4gICAgcHJpdmF0ZSBnZXRDUlNWYWx1ZSgpOiBzdHJpbmcge1xuICAgICAgICBmdW5jdGlvbiB0cmltcGVtKHBlbTogc3RyaW5nKSB7XG4gICAgICAgICAgICByZXR1cm4gcGVtLnJlcGxhY2UoL1xcbi9nLCAnJylcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IENTUklucHV0RWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjc3InKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkodHJpbXBlbShDU1JJbnB1dEVsZW1lbnQudmFsdWUpKVxuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tDc3IoY2FsbGJhY2s6IFZvaWRGdW5jdGlvbik6IGFueSB7XG4gICAgICAgIHRoaXMuc2V0QnV0dG9uTG9hZGluZyh0cnVlKTtcblxuICAgICAgICBjb25zdCBDUlNWYWx1ZSA9IHRoaXMuZ2V0Q1JTVmFsdWUoKTtcblxuICAgICAgICBmZXRjaChgJHt0aGlzLmJhY2tlbmRfdXJsfS9hcGkvdjEvY2hlY2tgLCB7XG4gICAgICAgICAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICAgICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGJvZHk6IENSU1ZhbHVlLFxuICAgICAgICB9KVxuICAgICAgICAgICAgLnRoZW4oYXN5bmMgcmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGVycm9yTXNnID0gYCgke3Jlc3BvbnNlLnN0YXR1c30pYDtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJhY2tlbmRNc2cgPSAnJztcbiAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5jbG9uZSgpLmpzb24oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tlbmRNc2cgPSBkYXRhLm1lc3NhZ2UgfHwgSlNPTi5zdHJpbmdpZnkoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgIH0gY2F0Y2gge1xuICAgICAgICAgICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBiYWNrZW5kTXNnID0gYXdhaXQgcmVzcG9uc2UuY2xvbmUoKS50ZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGNhdGNoIHt9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKGJhY2tlbmRNc2cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTXNnID0gYmFja2VuZE1zZztcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZXJyb3JNc2cpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC50aGVuKGRhdGEgPT4geyAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvdW50cnlfbmFtZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlID0gZGF0YS5jb3VudHJ5O1xuICAgICAgICAgICAgICAgIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3RhdGVfbmFtZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlID0gZGF0YS5zdGF0ZTtcbiAgICAgICAgICAgICAgICAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvY2FsaXR5X25hbWUnKSBhcyBIVE1MSW5wdXRFbGVtZW50KS52YWx1ZSA9IGRhdGEubG9jYWxpdHk7XG4gICAgICAgICAgICAgICAgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmdhbml6YXRpb25fbmFtZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlID0gZGF0YS5vcmdhbml6YXRpb247XG4gICAgICAgICAgICAgICAgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdvcmdhbml6YXRpb25fdW5pdF9uYW1lJykgYXMgSFRNTElucHV0RWxlbWVudCkudmFsdWUgPSBkYXRhLm9yZ2FuaXphdGlvblVuaXQ7XG4gICAgICAgICAgICAgICAgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tb25fbmFtZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlID0gZGF0YS5jb21tb25OYW1lO1xuICAgICAgICAgICAgICAgIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZW1haWxfYWRkcmVzcycpIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlID0gZGF0YS5lbWFpbEFkZHJlc3M7XG5cbiAgICAgICAgICAgICAgICB0aGlzLnNldEJ1dHRvbkxvYWRpbmcoZmFsc2UpO1xuICAgICAgICAgICAgICAgIGNhbGxiYWNrKCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKChlcnJvcikgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuc2hvd0FsZXJ0KGAke2Vycm9yLm1lc3NhZ2V9IChcImFwaS92MS9jaGVja1wiKWApXG4gICAgICAgICAgICAgICAgdGhpcy5zZXRCdXR0b25Mb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBwcml2YXRlIHNpZ24oY2FsbGJhY2s6IFZvaWRGdW5jdGlvbik6IGFueSB7XG4gICAgICAgIGNvbnN0IENSU1ZhbHVlID0gdGhpcy5nZXRDUlNWYWx1ZSgpO1xuICAgICAgICBjb25zdCBjb21tb25OYW1lID0gKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb21tb25fbmFtZScpIGFzIEhUTUxJbnB1dEVsZW1lbnQpLnZhbHVlXG4gICAgICAgIGNvbnN0IENhTmFtZSA9IChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lnbl93aXRoX2NhJykgYXMgSFRNTFNlbGVjdEVsZW1lbnQpLnZhbHVlXG4gICAgICAgIFxuICAgICAgICBmZXRjaChgJHt0aGlzLmJhY2tlbmRfdXJsfS9hcGkvdjEvc2lnbmAsIHtcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgaGVhZGVyczoge1xuICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgIENzcjogQ1JTVmFsdWUsXG4gICAgICAgICAgICAgICAgY29tbW9uTmFtZTogY29tbW9uTmFtZSxcbiAgICAgICAgICAgICAgICBDYU5hbWU6IENhTmFtZVxuICAgICAgICAgICAgfSksXG4gICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgY29udGVudERpc3Bvc2l0aW9uID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoJ0NvbnRlbnQtRGlzcG9zaXRpb24nKTtcbiAgICAgICAgICAgICAgICBjb25zdCBmaWxlbmFtZU1hdGNoID0gY29udGVudERpc3Bvc2l0aW9uLm1hdGNoKC9maWxlbmFtZT0oW147XSspLyk7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlsZW5hbWUgPSBmaWxlbmFtZU1hdGNoID8gZmlsZW5hbWVNYXRjaFsxXSA6ICdjZXJ0aWZpY2F0ZS5wZW0nO1xuICAgICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5ibG9iKCkudGhlbihibG9iID0+ICh7IGJsb2IsIGZpbGVuYW1lIH0pKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAudGhlbigoeyBibG9iLCBmaWxlbmFtZSB9KSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYXYtc3RlcC10aHJlZS1jb25maXJtJykgYXMgSFRNTEFuY2hvckVsZW1lbnQ7XG4gICAgICAgICAgICAgICAgY29uc3QgdXJsID0gd2luZG93LlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG5cbiAgICAgICAgICAgICAgICBlbGVtZW50LmhyZWYgPSB1cmw7XG4gICAgICAgICAgICAgICAgZWxlbWVudC5kb3dubG9hZCA9IGZpbGVuYW1lO1xuXG4gICAgICAgICAgICAgICAgY2FsbGJhY2soKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaG93QWxlcnQoYCR7ZXJyb3IubWVzc2FnZX0gKFwiYXBpL3YxL3NpZ25cIilgKTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbiAgICBcblxufSIsIi8vIFRoZSBtb2R1bGUgY2FjaGVcbnZhciBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX18gPSB7fTtcblxuLy8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbmZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG5cdHZhciBjYWNoZWRNb2R1bGUgPSBfX3dlYnBhY2tfbW9kdWxlX2NhY2hlX19bbW9kdWxlSWRdO1xuXHRpZiAoY2FjaGVkTW9kdWxlICE9PSB1bmRlZmluZWQpIHtcblx0XHRyZXR1cm4gY2FjaGVkTW9kdWxlLmV4cG9ydHM7XG5cdH1cblx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcblx0dmFyIG1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF0gPSB7XG5cdFx0Ly8gbm8gbW9kdWxlLmlkIG5lZWRlZFxuXHRcdC8vIG5vIG1vZHVsZS5sb2FkZWQgbmVlZGVkXG5cdFx0ZXhwb3J0czoge31cblx0fTtcblxuXHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cblx0X193ZWJwYWNrX21vZHVsZXNfX1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cblx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcblx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xufVxuXG4iLCJpbXBvcnQgeyBQS0kgfSBmcm9tICcuL1BraSdcblxubmV3IFBLSSgpOyJdLCJuYW1lcyI6WyJiYWNrZW5kX3VybCIsImN1cnJlbnRTdGVwIiwibGlzdENlcnRzRmV0Y2hlZCIsIm9uU3RlcE9uZUNvbmZpcm0iLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwiZmV0Y2hMaXN0Q2VydHMiLCJjaGVja0NzciIsImluaXRDb250ZW50VHdvIiwiYmluZCIsIm9uU3RlcFR3b0NvbmZpcm0iLCJzaWduIiwiaW5pdENvbnRlbnRUaHJlZSIsIm9uQmFja0NsaWNrIiwiaW5pdENvbnRlbnRPbmUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiZGlzYWJsZWQiLCJ0aGlzIiwiaW5pdCIsImFkZEV2ZW50TGlzdGVuZXJzIiwiYWRkRXZlbnRMaXN0ZW5lciIsImNoYW5nZUNvbnRlbnQiLCJjb3VudCIsInNldFN0ZXBwZXJDb250ZW50Iiwic2V0TmF2U3RlcHBlciIsInNldFN0ZXBwZXJPdmVydmlldyIsInN0ZXBwZXJDb250ZW50IiwiZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSIsImkiLCJsZW5ndGgiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJuYXZTdGVwcGVyIiwic3RlcHBlck92ZXJ2aWV3RWxlbWVudHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiJGlubmVyY2lyY2xlIiwicXVlcnlTZWxlY3RvciIsIiR0ZXh0IiwiY29udGFpbnMiLCIkbnVtYmVyIiwiJGNoZWNrYm94Iiwic2V0U3VjY2Vzc0NsYXNzIiwic2V0QWN0aXZlQ2xhc3MiLCJzaG93QWxlcnQiLCJtZXNzYWdlIiwiZXJyb3JFbGVtZW50IiwidGV4dENvbnRlbnQiLCJzZXRCdXR0b25Mb2FkaW5nIiwiZW5hYmxlIiwiZm9yRWFjaCIsImJ1dHRvbkVsZW1lbnQiLCJmZXRjaCIsIm1ldGhvZCIsImhlYWRlcnMiLCJ0aGVuIiwicmVzcG9uc2UiLCJqc29uIiwiZGF0YSIsInNpZ25XaXRoQ2EiLCJlbGVtZW50Iiwib3B0aW9ucyIsIk9wdGlvbiIsImNhdGNoIiwiZXJyb3IiLCJnZXRDUlNWYWx1ZSIsIkNTUklucHV0RWxlbWVudCIsIkpTT04iLCJzdHJpbmdpZnkiLCJ2YWx1ZSIsInJlcGxhY2UiLCJjYWxsYmFjayIsIkNSU1ZhbHVlIiwiYm9keSIsIm9rIiwiZXJyb3JNc2ciLCJzdGF0dXMiLCJiYWNrZW5kTXNnIiwiY2xvbmUiLCJ0ZXh0IiwiRXJyb3IiLCJjb3VudHJ5Iiwic3RhdGUiLCJsb2NhbGl0eSIsIm9yZ2FuaXphdGlvbiIsIm9yZ2FuaXphdGlvblVuaXQiLCJjb21tb25OYW1lIiwiZW1haWxBZGRyZXNzIiwiQ2FOYW1lIiwiQ3NyIiwiZmlsZW5hbWVNYXRjaCIsImdldCIsIm1hdGNoIiwiZmlsZW5hbWUiLCJibG9iIiwidXJsIiwid2luZG93IiwiVVJMIiwiY3JlYXRlT2JqZWN0VVJMIiwiaHJlZiIsImRvd25sb2FkIiwiUEtJIiwiX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiY2FjaGVkTW9kdWxlIiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIl0sInNvdXJjZVJvb3QiOiIifQ==